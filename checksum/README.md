
There are two programs here:
- calculate_checksum 
- compare_checksum 



## Usage 

### calculate_checksum

`calculate_checksum` calculates checksum for the tables specified in the config.toml file. If you don't specify tables, `calculate_checksum`
will process all the tables in the target schema. 

Currently, we only support one schema for one instance of `calculate_checksum`. If you have multiple schemas to run, you may need to prepare multiple configuration files. You can run  `calculate_checksum` concurrently, but keep in mind that it may utilize CPU heavily.


`calculate_checksum` will generate a series of checksum result files based on the name of `<host>_<port>_<schema>_<table>.checksum`.
There will also be some chunk checksum files record checksum for each chunk(for most of the time you don't need to read it, may be useful for debugging). Chunk checksum files is based on the named of `<host>_<port>_<schema>_<table>.chunkchecksums`


Checksum files example.
```
├── 127.0.0.1_3309_sbtest4_sbtest1.checksum
├── 127.0.0.1_3309_sbtest4_sbtest1.chunkchecksums
├── 127.0.0.1_3309_sbtest4_sbtest2.checksum
├── 127.0.0.1_3309_sbtest4_sbtest2.chunkchecksums
├── 127.0.0.1_3309_sbtest4_sbtest3.checksum
├── 127.0.0.1_3309_sbtest4_sbtest3.chunkchecksums
├── 127.0.0.1_3309_sbtest4_sbtest4.checksum
├── 127.0.0.1_3309_sbtest4_sbtest4.chunkchecksums
├── 127.0.0.1_3309_sbtest4_sbtest5.checksum
├── 127.0.0.1_3309_sbtest4_sbtest5.chunkchecksums
├── 127.0.0.1_4000_sbtest4_sbtest1.checksum
├── 127.0.0.1_4000_sbtest4_sbtest1.chunkchecksums
├── 127.0.0.1_4000_sbtest4_sbtest2.checksum
├── 127.0.0.1_4000_sbtest4_sbtest2.chunkchecksums
├── 127.0.0.1_4000_sbtest4_sbtest3.checksum
├── 127.0.0.1_4000_sbtest4_sbtest3.chunkchecksums
├── 127.0.0.1_4000_sbtest4_sbtest4.checksum
├── 127.0.0.1_4000_sbtest4_sbtest4.chunkchecksums
├── 127.0.0.1_4000_sbtest4_sbtest5.checksum
├── 127.0.0.1_4000_sbtest4_sbtest5.chunkchecksums
```


#### configurations examples

A full example of configurations of `calculate_checksum`.

```
# checksum related program configurations
log-level = "info"
log-file = "checksum.log"

#profile-port = 9999

# for example, the whole data is [1...100]
# we can split these data to [1...10], [11...20], ..., [91...100]
# the [1...10] is a chunk, and it's chunk size is 10
# size of the split chunk
chunk-size = 100

# how many goroutines are created to check data
check-thread-count = 4

# sampling check percent, for example 10 means only check 10% data
sample-percent = 100


[source-db]
host = "127.0.0.1"
port = 4000
user = "root"
password = ""
# schema name
schema = "sbtest4"

# if check-table is empty, all tables in the schema will be checked.
# [[check-table]] is a list.
#[[check-table]]
# table name.
#name = "sbtest1"

# field should be the primary key, unique key or field with index. 
# if comment this, diff will find a suitable field.
#index-field = "id"

# check data's range
#range = "id<100"
```

If you want to specify tables to be processed, use `[[check-table]]`. You can also specify the `range` condition in the `[[check-table]]` section, which will appear in `SELECT * FROM sbtest4.sbtest1 WHERE <built-in-condition> AND id<100` for example.

#### running example

```

# create a sharding_config.toml(named it whatever you want) and make your own rules on what tables to be processed.
./calculate_checksum -config sharding_config.toml

# create a merged_config.toml(named it whatever you want), and make you own rules on what tables to be processed. 

./calculate_checksum -config merged_config.toml 

```

If you want to compare the table checksums, see the next part of `compare_checksum`.


### compare_checksum 

`compare_checksum` is used to compare table checksum generated by `calculate_checksum`.



#### configuration example

A full example of the configurations of `compare_checksum`.

```
# checksum related program configurations
log-level = "info"
log-file = "checksum.log"

#profile-port = 9999

# [[compare]] is a list
[[compare]]
# Put sharding table checksum files to 'from' section
from = [
    "./127.0.0.1_3309_sbtest4_sbtest1.checksum",
]
# Put the merged table checksum files to 'to' section. For most cases it should be only one file here.
to = [
    "./127.0.0.1_4000_sbtest4_sbtest1.checksum"
]

[[compare]]
# Put sharding table checksum files to 'from' section
from = [
    "./127.0.0.1_3309_sbtest4_sbtest2.checksum",
]
# Put the merged table checksum files to 'to' section. For most cases it should be only one file here.
to = [
    "./127.0.0.1_4000_sbtest4_sbtest2.checksum"
]

```

#### running example

```

# create a compare_checksum.toml(named it whatever you want) and make your own rules on what checksum files to be processed.

./compare_checksum -config compare_checksum.toml 
```